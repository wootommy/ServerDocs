# é‡è£… Ubuntu ç³»ç»Ÿä¸é©±åŠ¨

æœ¬ç¯‡æ–‡æ¡£è®°å½•é‡è£… 442 æœåŠ¡å™¨ç³»ç»Ÿçš„åŸºæœ¬æµç¨‹ã€‚

```warning:: âš ï¸ æ³¨æ„ï¼Œè¯¥æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯ Ubuntu ç³»ç»Ÿæ¡Œé¢ç‰ˆï¼Œéƒ¨åˆ†æœåŠ¡ç¨‹åºéœ€è¦é•¿æœŸä¿æŒåœ¨åå°ï¼ŒåŒ…æ‹¬éƒ¨åˆ†é¡¹ç›®çš„æ•°æ®æ¥æ”¶ã€æ•°æ®åº“è¿œç¨‹è®¿é—®ã€é¡¹ç›®ä¸»é¡µå±•ç¤ºç­‰ç­‰ã€‚è¯·åœ¨è¯¦ç»†äº†è§£ã€ç¡®è®¤åå°åŒ…å«çš„æœåŠ¡ä¹‹åï¼Œä¸é¡¹ç›®è´Ÿè´£äººè¿›è¡Œæ²Ÿé€šï¼Œå¹¶å®Œæˆå¿…è¦é¡¹ç›®çš„è¿ç§»ï¼Œæœ€åå†æ‰§è¡Œé‡è£…æ“ä½œã€‚

```

442 æœåŠ¡å™¨æœ€è¿‘ä¸€æ¬¡ç³»ç»Ÿçº§åˆ«é‡æ–°é…ç½®æ—¶é—´ï¼š20201214ã€‚

å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤æŸ¥çœ‹ä¸Šä¸€æ¬¡ç³»ç»Ÿé‡è£…æ—¶é—´ï¼š

```sh
# check system mounted hard disk, nvme by default
> df -P /
Filesystem     1024-blocks      Used Available Capacity Mounted on
/dev/nvme0n1p2   490691512 238371724 227324308      52% /

# grep filesystem created timestamp
> tune2fs -l /dev/nvme0n1p1 |grep 'Filesystem created:'
Filesystem created:       Mon Dec 14 10:24:44 2020
```

```note:: â€œæœåŠ¡å™¨åˆè¦é‡è£…äº†ã€‚â€â€”â€”å¸Œæœ›åé¢å°‘å¬åˆ°è¿™å¥å·¥ä½œé‡æ»¡æ»¡çš„è¯ ğŸ˜‚ã€‚

```

## é‡è£…ç³»ç»Ÿ

```warning:: âš ï¸ é‡è£…ç³»ç»Ÿä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²ç»å®Œæˆäº†å¿…è¦çš„é¡¹ç›®è¿ç§»ï¼Œå¤‡ä»½äº†ç›¸å…³èµ„æ–™æ•°æ®ã€‚

```

### å‡†å¤‡å†…å®¹

é‡è£…æœåŠ¡å™¨ä¹‹å‰ï¼Œå‡†å¤‡ï¼š

-   ä¸€ä¸ªå®¹é‡å¤§äºç­‰äº 8G çš„ U ç›˜æˆ–ç§»åŠ¨ç¡¬ç›˜ï¼›
-   åˆé€‚çš„ Ubuntu ç³»ç»Ÿé•œåƒï¼Œæ¨èä½¿ç”¨æœ€æ–°æˆ–æ¬¡æ–° LTS ç‰ˆæœ¬ï¼Œé€‰æ‹©æ¡Œé¢ç‰ˆç³»ç»Ÿï¼Œå®˜ç½‘[é“¾æ¥](https://releases.ubuntu.com/)ï¼›
-   å…è´¹çš„ç³»ç»Ÿé•œåƒå†™å…¥è½¯ä»¶ Etcherï¼Œå®˜ç½‘[é“¾æ¥](https://www.etcher.net/)ï¼›

![](./../../assets/img/ubuntu_versions.jpg "ubuntu_versions.jpg")

### é‡è£…æµç¨‹

ä»¥ä¸‹ä¸ºé€šç”¨çš„ç³»ç»Ÿé‡è£…æ­¥éª¤ï¼š

-   ä½¿ç”¨ Etcher è½¯ä»¶ï¼Œå°†ä¸‹è½½å¥½çš„ç³»ç»Ÿé•œåƒå†™å…¥ U ç›˜ï¼Œåˆ¶ä½œä¸ºå¯å¼•å¯¼å¯åŠ¨ç›˜ï¼ˆè¿™ä¸ªè¿‡ç¨‹é€šè¿‡ Etcher å®Œæˆéå¸¸è½»æ¾ï¼‰ï¼›
-   æ’å…¥ U ç›˜ï¼Œé•¿æŒ‰å…³æœºé”®é‡å¯æœåŠ¡å™¨ä¸»æœºï¼Œåœ¨æ˜¾ç¤ºå™¨é‡æ–°å‡ºç°ä¸»æ¿å‚å•†å›¾æ¡ˆæ—¶ï¼ŒæŒ‰ `del` é”®è¿›å…¥ä¸»æ¿ BIOS è®¾ç½®ç•Œé¢ï¼ˆå…·ä½“è¿‡ç¨‹å‚è§ä¸åŒä¸»æ¿çš„è¯´æ˜ä¹¦ï¼‰ï¼›
-   åœ¨ BIOS ç•Œé¢è°ƒæ•´å¼•å¯¼ç›˜é¡ºåºï¼Œå°†æ’å…¥çš„ U ç›˜è®¾ç½®ä¸ºç¬¬ä¸€å¯åŠ¨å¼•å¯¼é¡¹ï¼›
-   ä¿å­˜ BIOS è®¾ç½®ï¼Œé‡å¯æœåŠ¡å™¨ä¸»æœºï¼›
-   ä» U ç›˜åŠ è½½å¯åŠ¨é•œåƒå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œè€å¿ƒç­‰å¾…åï¼Œè¿›å…¥å¸¸è§„çš„ç³»ç»Ÿå®‰è£…æµç¨‹ã€‚

### Ubuntu ç³»ç»Ÿå®‰è£…æµç¨‹

å¤šæ•°å®‰è£…è¿‡ç¨‹é‡çš„è®¾ç½®é¡¹é€‰å–é»˜è®¤å³å¯ï¼Œè¿™é‡Œåˆ—ä¸¾ä¸€äº›éœ€è¦æ³¨æ„çš„è®¾ç½®é¡¹ï¼š

-   ç³»ç»Ÿè¯­è¨€ä¿æŒè‹±æ–‡ï¼Œç³»ç»Ÿå®‰è£…å®Œæˆåå†æ‰‹åŠ¨æ·»åŠ ä¸­æ–‡è¾“å…¥æ³•ï¼›
-   æ¥å—é™„å¸¦çš„å›¾å½¢ã€åª’ä½“ç»„ä»¶ç­‰é¢å¤–åŒ…çš„å®‰è£…ï¼Œæ¥å—å®‰è£…æ—¶ä¸‹è½½æ›´æ–°ï¼›
-   å®‰è£…ç±»å‹é€‰å–æ¸…é™¤æ•´ä¸ªç£ç›˜ï¼Œè¿›è¡Œå½»åº•çš„é‡æ–°å®‰è£…ï¼›
-   è®¾ç½®åˆé€‚çš„è®¡ç®—æœºåç§°ã€ç”¨æˆ·åä¸å¯†ç ï¼Œè¯¥ç”¨æˆ·ä¸ºç³»ç»Ÿç®¡ç†å‘˜è´¦æˆ·ï¼Œå¦‚ `nami-442`ï¼›

```note:: ç³»ç»Ÿæ›´æ–°ç»´æŠ¤éœ€è¦ä¸­æ–­æœåŠ¡ï¼Œå› æ­¤åœ¨å®‰è£…æ—¶å°½é‡ä¿æŒå®‰è£…åŒ…çš„ä¸ºæœ€æ–°çš„ç‰ˆæœ¬ï¼Œåç»­å†å®šæœŸæ‰§è¡Œæ›´æ–°ã€‚

```

### æ³¨æ„äº‹é¡¹

æå‰çŸ¥æ™“è¿™äº›æ³¨æ„äº‹é¡¹ï¼š

-   442 æœåŠ¡å™¨å¹¶éä¸€èˆ¬æ‰€è¯´çš„æœåŠ¡å™¨ï¼Œå®ƒæ›´å¤šåœ°æ˜¯ä¸€å°æ€§èƒ½ä¼˜è¶Šçš„å…±äº«ä¸»æœºï¼Œå› æ­¤ä¾ç„¶é€‚ç”¨äº Ubuntu ç³»ç»Ÿæ¡Œé¢ç‰ˆã€‚
-   å®è·µæ¥çœ‹ï¼Œè¿™å°æœåŠ¡å™¨é‡å¯çš„è¿‡ç¨‹æ¯”è¾ƒç¼“æ…¢ï¼Œåœ¨æ˜¾ç¤ºå™¨é€šç”µä¹‹åä¼šä¿æŒé»‘å±ä¸€æ®µæ—¶é—´ï¼Œæ¨æµ‹æ˜¯åœ¨è¿›è¡Œç£ç›˜é˜µåˆ—çš„æ£€æŸ¥ï¼Œå› æ­¤è¯·è€å¿ƒç­‰å¾…ï¼ˆå¯èƒ½é•¿è¾¾ 10 åˆ†é’Ÿï¼‰ã€‚
-   Linux ç±»ç³»ç»Ÿæä¾›äº† 6 ä¸ªè™šæ‹Ÿç»ˆç«¯ï¼Œå…¶ä¸­ç¬¬ 1 ä¸ªæ˜¯é»˜è®¤çš„å›¾å½¢ç•Œé¢ï¼Œç¬¬ 2 åˆ° 6 ä¸ªåˆ™æ˜¯å‘½ä»¤è¡Œç•Œé¢ã€‚å¯ä»¥é€šè¿‡ `ctrl` + `alt` + `F1[~6]` ç»„åˆé”®åœ¨ä¸åŒçš„è™šæ‹Ÿç»ˆç«¯ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚è¿™é€‚ç”¨äºå¤šä»»åŠ¡å¤„ç†ï¼Œæˆ–è€…å…¶ä¸­æŸä¸ªç»ˆç«¯å‡ºç°å¡æ­»çš„æƒ…å†µã€‚
-   è¯·ç†Ÿæ‚‰åŸºæœ¬çš„ Linux ç±»ç³»ç»ŸæŒ‡ä»¤ã€‚

## å®‰è£… Nvidia é©±åŠ¨

### 20.04 åŠä¹‹å

```important:: 20201214 æ›´æ–°ï¼šåœ¨æœ€æ–°çš„ Ubuntu 20.04 ç³»ç»Ÿä¸‹ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨è‡ªå¸¦çš„é©±åŠ¨ç®¡ç†ï¼Œè‡ªåŠ¨å®‰è£…åˆé€‚çš„ Nvidia é©±åŠ¨ã€‚

```

![](../../assets/img/nvidia_driver.jpg)

é€‰å–åˆé€‚çš„é©±åŠ¨ç‰ˆæœ¬åï¼Œç‚¹å‡» Apply Changes å³å¯ã€‚ç³»ç»Ÿå®Œæˆé©±åŠ¨å®‰è£…åä¼šè¦æ±‚é‡å¯ã€‚

### 18.04 åŠä¹‹å‰

å¯¹äº 18.04 ç‰ˆæœ¬ä¹‹å‰çš„ Ubuntu ç³»ç»Ÿå‚è€ƒä¸€ä¸‹æ­¥éª¤ã€‚åœ¨ç³»ç»Ÿå®‰è£…è¿‡ç¨‹ä¸­ï¼Œå¤šæ•°ç¡¬ä»¶é©±åŠ¨ä¼šè‡ªåŠ¨å®‰è£…æœ€é€‚åˆç‰ˆæœ¬æˆ–åŸºæœ¬çš„å…¼å®¹ç‰ˆæœ¬ï¼Œä¸ç”¨èŠ±å¿ƒæ€å»æ‰‹åŠ¨é€‚é…ï¼Œå®ƒä»¬ä¸€èˆ¬èƒ½å¾ˆå¥½åœ°é…åˆç³»ç»Ÿç¡¬ä»¶å·¥ä½œã€‚

å”¯ç‹¬éœ€è¦æ³¨æ„çš„ï¼ŒNvidia æ˜¾å¡çš„é©±åŠ¨ä¸åœ¨å¯è‡ªåŠ¨å®‰è£…é©±åŠ¨çš„æ”¯æŒåˆ—è¡¨å†…ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨è¿›è¡Œå®‰è£…ã€‚è¿™é‡Œåˆ—ä¸¾å®‰è£… Nvidia æ˜¾å¡åœ¨ Ubuntu ç³»ç»Ÿä¸Šé©±åŠ¨çš„æ­¥éª¤ã€‚

```warning:: æ— æ³•åœ¨ SSH è¿œç¨‹è¿æ¥æ¨¡å¼ä¸‹å®Œæˆé©±åŠ¨çš„å®‰è£…ï¼Œè¯·åœ¨ 442 æœåŠ¡å™¨æœ¬æœºä¸Šè¿›è¡Œæ“ä½œã€‚

```

åŸºæœ¬åœ°ï¼Œæˆ‘ä»¬éœ€è¦ç¦ç”¨ç³»ç»Ÿè‡ªåŠ¨é€‚é…çš„ç¬¬ä¸‰æ–¹æ˜¾å¡é©±åŠ¨ï¼Œè¿›å…¥æ²¡æœ‰å›¾å½¢ç•Œé¢çš„å‘½ä»¤è¡Œç»ˆç«¯æ¨¡å¼ï¼›å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…åï¼Œæ‰‹åŠ¨å®‰è£… Nvidia æ˜¾å¡é©±åŠ¨ï¼›æœ€åé‡å¯ç³»ç»Ÿã€‚

```note:: ç¦ç”¨ç¬¬ä¸‰æ–¹æ˜¾å¡é©±åŠ¨åï¼Œç³»ç»Ÿä¸å†æä¾›å›¾å½¢åŒ–ç•Œé¢ï¼Œåˆ‡æ¢åˆ°å‘½ä»¤è¡Œç»ˆç«¯æ‰§è¡Œåç»­æ“ä½œã€‚

```

-   é¦–å…ˆç¡®è®¤ç³»ç»Ÿè¯†åˆ«åˆ°äº† Nvidia å¡ã€‚Nvidia å¡å‹å·ä¸ Ubuntu ç‰ˆæœ¬å¤§è‡´åŒ¹é…å°±è¡Œã€‚

    ```sh
    # show nvidia graphic card items
    > lspci | grep -i nvidia
    19:00.0 VGA compatible controller: NVIDIA Corporation Device 1e04 (rev a1)
    19:00.1 Audio device: NVIDIA Corporation Device 10f7 (rev a1)
    19:00.2 USB controller: NVIDIA Corporation Device 1ad6 (rev a1)
    19:00.3 Serial bus controller [0c80]: NVIDIA Corporation Device 1ad7 (rev a1)
    ...
    ```

    è¿™é‡Œå‡ºç° NVIDIA Corporation Device ä¿¡æ¯å³å¯ï¼Œè¡¨ç¤ºç³»ç»Ÿå·²ç»è¯†åˆ«åˆ°äº†è¯¥æ˜¾å¡ã€‚

-   ç¦ç”¨è‡ªåŠ¨é€‚é…çš„ç¬¬ä¸‰æ–¹é©±åŠ¨ nouveauã€‚

    ```sh
    # new .conf
    vim /etc/modprobe.d/blacklist.conf

    # add config
    blacklist nouveau
    options nouveau modeset=0

    # refresh and reboot
    update-initramfs -u
    reboot

    # checkup now, outputs ought to be none
    lsmod | grep nouveau
    ```

-   åœ¨å®‰è£… Nvidia é©±åŠ¨ä¹‹å‰ï¼Œå…ˆæ·»åŠ ä¾èµ–åŒ…ã€‚

    ```sh
    # install compile depended packages
    apt install build-essential pkg-config xserver-xorg-dev linux-headers-`uname -r`
    apt install gcc make
    ```

-   ä¸‹è½½é©±åŠ¨å®‰è£…ç¨‹åºï¼Œ[é“¾æ¥](https://www.nvidia.com/Download/index.aspx)ï¼Œä¸‹è½½å¾—åˆ° `.run` æ–‡ä»¶ï¼Œä½¿ç”¨ bash æ‰§è¡Œè¯¥å®‰è£…æ–‡ä»¶ï¼Œæœ€åé‡å¯æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸã€‚

    ![](../../assets/img/nvidia_version.jpg)

    ```sh
    # switch to terminal mode
    ctrl + alt + fn # f7 for GUI

    # stop GUI service
    service lightdm stop

    # chmod and install
    chmod +x NVIDIA-Linux-x86_64-450.27.run
    bash NVIDIA-Linux-x86_64-450.27.run â€“no-opengl-files â€“no-x-check â€“no-nouveau-check
    # note: might be some minor warnings; no 32bit installations.

    # reboot and check
    reboot
    nvidia-smi
    ```

## å®‰è£… CUDA

CUDA è‡ªç„¶æ˜¯è·‘ä¸æ‰çš„ã€‚CUDA ç‰ˆæœ¬è¯·æ ¹æ®å½“å‰è½¯ä»¶åŒ…çš„é€‚é…æƒ…å†µè¿›è¡Œé€‰æ‹©ã€‚

-   ä¸‹è½½ CUDA å®‰è£…ç¨‹åºï¼Œ[é“¾æ¥](https://developer.nvidia.com/cuda-10.2-download-archive)ï¼Œå¾—åˆ° `.run` æ–‡ä»¶ï¼Œä½¿ç”¨ bash æ‰§è¡Œå®‰è£…ã€‚

    ```sh
    # install
    bash cuda_10.2.xxx._linux.run
    ```

    è¿™é‡Œä¼šè¿›å…¥ä¸€ä¸ªéå¸¸ç®€å•çš„å‘½ä»¤è¡Œå›¾å½¢åŒ–å®‰è£…ç•Œé¢ï¼Œåœ¨è¿‡ç¨‹ä¸­ï¼Œå¤šæ•°é€‰é¡¹ä¿æŒé»˜è®¤å€¼ï¼Œä½†éœ€è¦å–æ¶ˆé€‰ä¸­æ˜¯å¦é™„å¸¦å®‰è£…æ˜¾å¡é©±åŠ¨çš„é€‰æ¡†ã€‚

    ![](../../assets/img/cuda_options.jpg)

    ```note:: å®‰è£… CUDA æ—¶ï¼Œå–æ¶ˆå®ƒé™„å¸¦çš„æ˜¾å¡é©±åŠ¨å®‰è£…ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„æ­¥éª¤ä¸­å·²ç»å®‰è£…è¿‡é©±åŠ¨æ–‡ä»¶ã€‚

    ```

-   åœ¨å¯¹åº”çš„ç”¨æˆ·é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ  CUDA çš„ç¯å¢ƒå˜é‡ã€‚æ·»åŠ ä¹‹å `source` ä¸€ä¸‹ï¼Œåº”è¯¥å°±å¯ä»¥ç”¨ `nvcc -V` æŒ‡ä»¤äº†ã€‚

    ```sh
    export PATH="/usr/local/cuda-10.2/bin:$PATH"
    export LD_LIBRARY_PATH="/usr/lcoal/cuda-10.2/lib64:$LD_LIBRARY_PATH"
    ```

-   æœ€åï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼Œæ£€æŸ¥ CUDA ç‰ˆæœ¬ã€‚

    ```sh
    # check cuda version
    cat /usr/local/cuda/version.txt
    nvcc -V
    ```

## å®‰è£… cuDNN

cuDNN æ˜¯ä¸€ä¸ªä»£ç çº§åˆ«çš„è¿è¡ŒåŠ é€Ÿåº“ï¼Œé€šå¸¸éœ€è¦ä¸ CUDA åŒæ—¶å®‰è£…ã€‚

-   ä¸‹è½½ cuDNN å‹ç¼©æ–‡ä»¶ï¼Œ[é“¾æ¥](https://developer.nvidia.com/rdp/cudnn-archive)ï¼Œå¾—åˆ° `tgz` æ–‡ä»¶ã€‚è§£å‹ç¼©ï¼Œå¤åˆ¶æ–‡ä»¶åˆ°ç›¸åº”æ–‡ä»¶å¤¹å³å¯å®Œæˆå®‰è£…ã€‚

    ```sh
    # unpack
    tar -zxvf cudnn-10.2-linux-x64-v7.6.5.32.tgz

    # cp
    cp cuda/include/cudnn.h /usr/local/cuda/include/
    cp cuda/lib64/libcudnn* /usr/local/cuda/lib64/
    chmod a+r /usr/local/cuda/include/cudnn.h
    ```

-   å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼Œæ£€æŸ¥ cuDNN ç‰ˆæœ¬ã€‚

    ```sh
    # check cudnn version
    cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2
    ```
